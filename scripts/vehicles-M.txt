(async function() {
  function parseFrenchNumber(value) {
    if (!value || value === 'â€”' || value === '-' || value === '') return null;
    let cleaned = String(value).replace(/\s/g, '').replace(/â‚¬/g, '').trim();
    if (cleaned.includes(',') && !cleaned.includes('.')) cleaned = cleaned.replace(',', '.');
    else if (cleaned.includes(',') && cleaned.includes('.')) {
      const lastComma = cleaned.lastIndexOf(',');
      const lastDot = cleaned.lastIndexOf('.');
      if (lastComma > lastDot) cleaned = cleaned.replace(/\./g, '').replace(',', '.');
      else cleaned = cleaned.replace(/,/g, '');
    }
    const num = parseFloat(cleaned);
    return isNaN(num) ? null : num;
  }
  
  console.log('ğŸ”„ Chargement de Firebase...');
  const { initializeApp } = await import('https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js');
  const { getFirestore, collection, addDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js');
  
  if (!window.firebaseConfig2) {
    console.error('âŒ Configuration Firebase secondaire (firebaseConfig2) non trouvÃ©e');
    return;
  }
  
  let app2;
  try {
    app2 = initializeApp(window.firebaseConfig2, 'secondary');
  } catch (error) {
    if (error.code === 'app/duplicate-app') {
      const { getApps } = await import('https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js');
      app2 = getApps().find(app => app.name === 'secondary');
    } else {
      throw error;
    }
  }
  
  const db2 = getFirestore(app2);
  console.log('âœ… DeuxiÃ¨me base Firebase initialisÃ©e:', window.firebaseConfig2.projectId);
  
  const authState = JSON.parse(localStorage.getItem('ms_auth_state') || 'null');
  if (!authState || !authState.uid) {
    console.error('âŒ Vous devez Ãªtre connectÃ© pour importer des vÃ©hicules');
    return;
  }
  console.log('âœ… Utilisateur connectÃ©:', authState.email);
  
  const data = `Maserati	Levante 2016	61â€¯000 â‚¬	264	430	4	45	1â€¯830 â‚¬	5â€¯490 â‚¬	12â€¯810 â‚¬	18â€¯300 â‚¬
Maserati	GrandTurismo Liberty Walk	92â€¯000 â‚¬	300	855	3	45	2â€¯760 â‚¬	8â€¯280 â‚¬	19â€¯320 â‚¬	27â€¯600 â‚¬
Maserati	MC20	340â€¯000 â‚¬	325	630	1	15	10â€¯200 â‚¬	30â€¯600 â‚¬	71â€¯400 â‚¬	102â€¯000 â‚¬
Mazda	MX-5 Miata 1989	19â€¯500 â‚¬	200	115	1	25	585 â‚¬	1â€¯755 â‚¬	4â€¯095 â‚¬	5â€¯850 â‚¬
McLaren	720S Coupe 2018	293â€¯000 â‚¬	343	720	1	10	8â€¯790 â‚¬	26â€¯370 â‚¬	61â€¯530 â‚¬	87â€¯900 â‚¬
McLaren	Artura 2022	253â€¯000 â‚¬	330	680	1	14	7â€¯590 â‚¬	22â€¯770 â‚¬	53â€¯130 â‚¬	75â€¯900 â‚¬
McLaren	765LT	575â€¯640 â‚¬	330	775	1	10	17â€¯269 â‚¬	51â€¯808 â‚¬	120â€¯884 â‚¬	172â€¯692 â‚¬
McLaren	675 LT Spider	281â€¯500 â‚¬	320	675	1	12	8â€¯445 â‚¬	25â€¯335 â‚¬	59â€¯115 â‚¬	84â€¯450 â‚¬
McLaren	P1 2014	2â€¯360â€¯000 â‚¬	350	917	1	10	70â€¯800 â‚¬	212â€¯400 â‚¬	495â€¯600 â‚¬	708â€¯000 â‚¬
McLaren	W1	1â€¯950â€¯000 â‚¬	350	1500	1	10	58â€¯500 â‚¬	175â€¯500 â‚¬	409â€¯500 â‚¬	585â€¯000 â‚¬
McLaren	Senna 2018	800â€¯000 â‚¬	340	789	1	10	24â€¯000 â‚¬	72â€¯000 â‚¬	168â€¯000 â‚¬	240â€¯000 â‚¬
Mercedes	300 SL	800â€¯000 â‚¬	280	412	1	15	24â€¯000 â‚¬	72â€¯000 â‚¬	168â€¯000 â‚¬	240â€¯000 â‚¬
Mercedes	BRABUS 700 G63 AMG 6x6	893â€¯000 â‚¬	190	700	4	100	26â€¯790 â‚¬	80â€¯370 â‚¬	187â€¯530 â‚¬	267â€¯900 â‚¬
Mercedes	Benz AMG GT Black Series (Bande Carbone)	336â€¯000 â‚¬	325	730	1	15	10â€¯080 â‚¬	30â€¯240 â‚¬	70â€¯560 â‚¬	100â€¯800 â‚¬
Mercedes	AMG Project ONE	1â€¯800â€¯995 â‚¬	352	1063	1	15	54â€¯030 â‚¬	162â€¯090 â‚¬	378â€¯209 â‚¬	540â€¯299 â‚¬
Mercedes	AMG GT 63S 2018	208â€¯775 â‚¬	315	600	3	15	6â€¯263 â‚¬	18â€¯790 â‚¬	43â€¯843 â‚¬	62â€¯633 â‚¬
Mercedes	GT63s	237â€¯775 â‚¬	315	639	4	15	7â€¯133 â‚¬	21â€¯400 â‚¬	49â€¯933 â‚¬	71â€¯333 â‚¬
Mercedes	AMG GTR Pro	346â€¯000 â‚¬	318	600	1	15	10â€¯380 â‚¬	31â€¯140 â‚¬	72â€¯660 â‚¬	103â€¯800 â‚¬
Mercedes	AMG GTR Pro Bande Bleue	346â€¯000 â‚¬	318	600	1	15	10â€¯380 â‚¬	31â€¯140 â‚¬	72â€¯660 â‚¬	103â€¯800 â‚¬
Mercedes	AMG GTR Pro Bande Jaune	346â€¯000 â‚¬	318	600	1	15	10â€¯380 â‚¬	31â€¯140 â‚¬	72â€¯660 â‚¬	103â€¯800 â‚¬
Mercedes	AMG GTR Pro Bande Orange	346â€¯000 â‚¬	318	600	1	15	10â€¯380 â‚¬	31â€¯140 â‚¬	72â€¯660 â‚¬	103â€¯800 â‚¬
Mercedes	AMG GTR Pro Bande Rose	346â€¯000 â‚¬	318	600	1	15	10â€¯380 â‚¬	31â€¯140 â‚¬	72â€¯660 â‚¬	103â€¯800 â‚¬
Mercedes	AMG GTR Pro Bande Rouge	346â€¯000 â‚¬	318	600	1	15	10â€¯380 â‚¬	31â€¯140 â‚¬	72â€¯660 â‚¬	103â€¯800 â‚¬
Mercedes	AMG GTR Pro Bande Verte	346â€¯000 â‚¬	318	600	1	15	10â€¯380 â‚¬	31â€¯140 â‚¬	72â€¯660 â‚¬	103â€¯800 â‚¬
Mercedes	SLS AMG 2013	200â€¯000 â‚¬	330	631	1	30	6â€¯000 â‚¬	18â€¯000 â‚¬	42â€¯000 â‚¬	60â€¯000 â‚¬
Mercedes	AMG SL 63	228â€¯000 â‚¬	315	585	1	30	6â€¯840 â‚¬	20â€¯520 â‚¬	47â€¯880 â‚¬	68â€¯400 â‚¬
Mercedes	Class A 2019	60â€¯000 â‚¬	266	420	3	30	1â€¯800 â‚¬	5â€¯400 â‚¬	12â€¯600 â‚¬	18â€¯000 â‚¬
Mercedes	AMG CLA 45 Shooting Break	65â€¯625 â‚¬	252	381	4	45	1â€¯969 â‚¬	5â€¯906 â‚¬	13â€¯781 â‚¬	19â€¯688 â‚¬
Mercedes	Benz CLA 45 250 2014	37â€¯500 â‚¬	250	610	4	45	1â€¯125 â‚¬	3â€¯375 â‚¬	7â€¯875 â‚¬	11â€¯250 â‚¬
Mercedes	CLA EV 2025	47â€¯500 â‚¬	250	381	6	45	1â€¯425 â‚¬	4â€¯275 â‚¬	9â€¯975 â‚¬	14â€¯250 â‚¬
Mercedes	C63S AMG 2017	124â€¯500 â‚¬	311	585	4	45	3â€¯735 â‚¬	11â€¯205 â‚¬	26â€¯145 â‚¬	37â€¯350 â‚¬
Mercedes	Benz C63 AMG Coupe Black	122â€¯000 â‚¬	300	517	4	25	3â€¯660 â‚¬	10â€¯980 â‚¬	25â€¯620 â‚¬	36â€¯600 â‚¬
Mercedes	AMG E63 S 2018	123â€¯000 â‚¬	290	612	4	35	3â€¯690 â‚¬	11â€¯070 â‚¬	25â€¯830 â‚¬	36â€¯900 â‚¬
Mercedes	Benz Class G 2019	104â€¯000 â‚¬	220	450	3	50	3â€¯120 â‚¬	9â€¯360 â‚¬	21â€¯840 â‚¬	31â€¯200 â‚¬
Mercedes	E-Class T-Model 2017	63â€¯200 â‚¬	273	300	4	50	1â€¯896 â‚¬	5â€¯688 â‚¬	13â€¯272 â‚¬	18â€¯960 â‚¬
Mercedes	GLE Coupe 2020	205â€¯000 â‚¬	270	380	4	50	6â€¯150 â‚¬	18â€¯450 â‚¬	43â€¯050 â‚¬	61â€¯500 â‚¬
Mercedes	ML 63 AMG	59â€¯350 â‚¬	301	450	4	35	1â€¯781 â‚¬	5â€¯342 â‚¬	12â€¯464 â‚¬	17â€¯805 â‚¬
Mercedes	ML 63 AMG 2	59â€¯350 â‚¬	301	450	4	35	1â€¯781 â‚¬	5â€¯342 â‚¬	12â€¯464 â‚¬	17â€¯805 â‚¬
Mercedes	ML63 BRABUS	196â€¯000 â‚¬	260	650	4	15	5â€¯880 â‚¬	17â€¯640 â‚¬	41â€¯160 â‚¬	58â€¯800 â‚¬
Mercedes	Maybach Pullman	296â€¯250 â‚¬	254	325	5	25	8â€¯888 â‚¬	26â€¯663 â‚¬	62â€¯213 â‚¬	88â€¯875 â‚¬
Mini	Cooper JCW GP 2020	42â€¯000 â‚¬	267	306	1	25	1â€¯260 â‚¬	3â€¯780 â‚¬	8â€¯820 â‚¬	12â€¯600 â‚¬
Mitsubishi	Lancer Evolution X	53â€¯250 â‚¬	280	500	4	25	1â€¯598 â‚¬	4â€¯793 â‚¬	11â€¯183 â‚¬	15â€¯975 â‚¬
Mitsubishi	Evolution IX	33â€¯250 â‚¬	261	325	4	15	998 â‚¬	2â€¯993 â‚¬	6â€¯983 â‚¬	9â€¯975 â‚¬
Moto	BMW M1000rr 2021	31â€¯641 â‚¬	306	212	1	12	949 â‚¬	2â€¯848 â‚¬	6â€¯645 â‚¬	9â€¯492 â‚¬
Moto	BMW 1200RT	10â€¯210 â‚¬	290	270	1	12	306 â‚¬	919 â‚¬	2â€¯144 â‚¬	3â€¯063 â‚¬
Moto	Ducatti Panigale V4 Speciale 2018	42â€¯188 â‚¬	300	214	1	12	1â€¯266 â‚¬	3â€¯797 â‚¬	8â€¯859 â‚¬	12â€¯656 â‚¬
Moto	Ducatti Hypermotard	16â€¯209 â‚¬	200	144	0	12	486 â‚¬	1â€¯459 â‚¬	3â€¯404 â‚¬	4â€¯863 â‚¬
Moto	Harley Davidson Fat Boy	13â€¯125 â‚¬	140	500	0	12	394 â‚¬	1â€¯181 â‚¬	2â€¯756 â‚¬	3â€¯938 â‚¬
Moto	Honda CRF 450	4â€¯260 â‚¬	140	230	0	12	128 â‚¬	383 â‚¬	895 â‚¬	1â€¯278 â‚¬
Moto	Honda Goldwing	31â€¯874 â‚¬	210	144	1	12	956 â‚¬	2â€¯869 â‚¬	6â€¯694 â‚¬	9â€¯562 â‚¬
Moto	Kawasaki KX 450	4â€¯260 â‚¬	140	500	0	12	128 â‚¬	383 â‚¬	895 â‚¬	1â€¯278 â‚¬
Moto	Kawasaki KX 450 1	4â€¯260 â‚¬	140	500	0	12	128 â‚¬	383 â‚¬	895 â‚¬	1â€¯278 â‚¬
Moto	Kawasaki KX 450 2	4â€¯260 â‚¬	140	500	0	12	128 â‚¬	383 â‚¬	895 â‚¬	1â€¯278 â‚¬
Moto	Kawasaki KX 450 3	4â€¯260 â‚¬	140	500	0	12	128 â‚¬	383 â‚¬	895 â‚¬	1â€¯278 â‚¬
Moto	Kawasaki KX 450 4	4â€¯260 â‚¬	140	500	0	12	128 â‚¬	383 â‚¬	895 â‚¬	1â€¯278 â‚¬
Moto	Kawasaki KX 450 5	4â€¯260 â‚¬	140	500	0	12	128 â‚¬	383 â‚¬	895 â‚¬	1â€¯278 â‚¬
Moto	KTM Super Dike R 2014	16â€¯015 â‚¬	280	330	0	12	480 â‚¬	1â€¯441 â‚¬	3â€¯363 â‚¬	4â€¯805 â‚¬
Moto	Suzuki GSX-R 1000 2014	17â€¯719 â‚¬	275	330	1	12	532 â‚¬	1â€¯595 â‚¬	3â€¯721 â‚¬	5â€¯316 â‚¬
Moto	Yamaha FJR1300 2009	6â€¯181 â‚¬	265	144	1	12	185 â‚¬	556 â‚¬	1â€¯298 â‚¬	1â€¯854 â‚¬
Moto	Yamaha MT-07 2018	6â€¯655 â‚¬	275	330	1	12	200 â‚¬	599 â‚¬	1â€¯398 â‚¬	1â€¯997 â‚¬
Moto	Yamaha TMAX 2017	8â€¯344 â‚¬	220	120	1	20	250 â‚¬	751 â‚¬	1â€¯752 â‚¬	2â€¯503 â‚¬
Moto	Tracer 900	17â€¯855 â‚¬	264	150	1	20	536 â‚¬	1â€¯607 â‚¬	3â€¯750 â‚¬	5â€¯357 â‚¬
Moto	Yamaha YZF R6 2017	13â€¯115 â‚¬	270	120	1	12	393 â‚¬	1â€¯180 â‚¬	2â€¯754 â‚¬	3â€¯935 â‚¬
Moto	Yamaha YZF R6 2017 Akrapovic	13â€¯115 â‚¬	270	120	1	12	393 â‚¬	1â€¯180 â‚¬	2â€¯754 â‚¬	3â€¯935 â‚¬
Moto	Yamaha YZF R6 2017 M1	13â€¯115 â‚¬	270	120	1	12	393 â‚¬	1â€¯180 â‚¬	2â€¯754 â‚¬	3â€¯935 â‚¬
Moto	Yamaha YZF R6 2017 M2	13â€¯115 â‚¬	270	120	1	12	393 â‚¬	1â€¯180 â‚¬	2â€¯754 â‚¬	3â€¯935 â‚¬
Moto	Yamaha YZF R6 2017 Akrapovic M	13â€¯115 â‚¬	270	120	1	12	393 â‚¬	1â€¯180 â‚¬	2â€¯754 â‚¬	3â€¯935 â‚¬
Moto	Yamaha YZF R6 2017 Akrapovic M	13â€¯115 â‚¬	270	120	1	12	393 â‚¬	1â€¯180 â‚¬	2â€¯754 â‚¬	3â€¯935 â‚¬`;
  
  const linesArray = data.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('//'));
  let imported = 0, errors = 0, skipped = 0;
  
  console.log(`ğŸš€ DÃ©but de l'importation de ${linesArray.length} vÃ©hicules dans la deuxiÃ¨me base...\n`);
  
  for (let i = 0; i < linesArray.length; i++) {
    const line = linesArray[i];
    const parts = line.split('\t');
    
    if (parts.length < 11) {
      console.warn(`âš ï¸  Ligne ${i + 1} ignorÃ©e (colonnes insuffisantes: ${parts.length})`);
      skipped++;
      continue;
    }
    
    const vehicle = {
      type: parts[0]?.trim() || 'Autre',
      modele: parts[1]?.trim() || '',
      prixAchat: parseFrenchNumber(parts[2]) || 0,
      vitesseMax: parseFrenchNumber(parts[3]),
      puissance: parseFrenchNumber(parts[4]),
      nombrePlaces: parseFrenchNumber(parts[5]),
      coffre: parseFrenchNumber(parts[6]),
      assuranceTier1: parseFrenchNumber(parts[7]),
      assuranceTier2: parseFrenchNumber(parts[8]),
      assuranceTier3: parseFrenchNumber(parts[9]),
      assuranceTier4: parseFrenchNumber(parts[10]),
      achete: false,
      createdAt: serverTimestamp()
    };
    
    if (!vehicle.modele || !vehicle.prixAchat) {
      console.warn(`âš ï¸  Ligne ${i + 1} ignorÃ©e (donnÃ©es incomplÃ¨tes)`);
      skipped++;
      continue;
    }
    
    try {
      await addDoc(collection(db2, 'flotte'), vehicle);
      imported++;
      if (imported % 10 === 0 || imported === 1) {
        console.log(`âœ… [${imported}] ${vehicle.type} ${vehicle.modele}`);
      }
      if (imported % 50 === 0) {
        await new Promise(resolve => setTimeout(resolve, 500));
      }
    } catch (error) {
      console.error(`âŒ Erreur ligne ${i + 1}: ${vehicle.modele}`, error.message || error);
      errors++;
    }
  }
  
  console.log('\n' + '='.repeat(50));
  console.log('ğŸ“Š RÃ‰SUMÃ‰ DE L\'IMPORT');
  console.log('='.repeat(50));
  console.log(`âœ… ImportÃ©s: ${imported}`);
  console.log(`âŒ Erreurs: ${errors}`);
  console.log(`âš ï¸  IgnorÃ©s: ${skipped}`);
  console.log(`ğŸ“¦ Total traitÃ©: ${linesArray.length}`);
  console.log(`ğŸ—„ï¸  Base: ${window.firebaseConfig2.projectId}`);
  console.log('='.repeat(50));
})();
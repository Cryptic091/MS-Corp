(async function() {
  function parseFrenchNumber(value) {
    if (!value || value === 'â€”' || value === '-' || value === '') return null;
    let cleaned = String(value).replace(/\s/g, '').replace(/â‚¬/g, '').trim();
    if (cleaned.includes(',') && !cleaned.includes('.')) cleaned = cleaned.replace(',', '.');
    else if (cleaned.includes(',') && cleaned.includes('.')) {
      const lastComma = cleaned.lastIndexOf(',');
      const lastDot = cleaned.lastIndexOf('.');
      if (lastComma > lastDot) cleaned = cleaned.replace(/\./g, '').replace(',', '.');
      else cleaned = cleaned.replace(/,/g, '');
    }
    const num = parseFloat(cleaned);
    return isNaN(num) ? null : num;
  }
  
  console.log('ğŸ”„ Chargement de Firebase...');
  const { initializeApp } = await import('https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js');
  const { getFirestore, collection, addDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js');
  
  if (!window.firebaseConfig2) {
    console.error('âŒ Configuration Firebase secondaire (firebaseConfig2) non trouvÃ©e');
    return;
  }
  
  let app2;
  try {
    app2 = initializeApp(window.firebaseConfig2, 'secondary');
  } catch (error) {
    if (error.code === 'app/duplicate-app') {
      const { getApps } = await import('https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js');
      app2 = getApps().find(app => app.name === 'secondary');
    } else {
      throw error;
    }
  }
  
  const db2 = getFirestore(app2);
  console.log('âœ… DeuxiÃ¨me base Firebase initialisÃ©e:', window.firebaseConfig2.projectId);
  
  const authState = JSON.parse(localStorage.getItem('ms_auth_state') || 'null');
  if (!authState || !authState.uid) {
    console.error('âŒ Vous devez Ãªtre connectÃ© pour importer des vÃ©hicules');
    return;
  }
  console.log('âœ… Utilisateur connectÃ©:', authState.email);
  
  const data = `Pagani	Zonda Tricolore 2010	1â€¯406â€¯250 â‚¬	350	658	1	10	42â€¯188 â‚¬	126â€¯563 â‚¬	295â€¯313 â‚¬	421â€¯875 â‚¬
Pagani	Utopia 2023	2â€¯000â€¯000 â‚¬	370	864	1	10	60â€¯000 â‚¬	180â€¯000 â‚¬	420â€¯000 â‚¬	600â€¯000 â‚¬
Peugeot	208 GT Line 2019	21â€¯281 â‚¬	208	177	3	25	638 â‚¬	1â€¯915 â‚¬	4â€¯469 â‚¬	6â€¯384 â‚¬
Peugeot	206	6â€¯750 â‚¬	191	125	4	25	203 â‚¬	608 â‚¬	1â€¯418 â‚¬	2â€¯025 â‚¬
Peugeot	E-2008 2020	34â€¯781 â‚¬	208	136	4	45	1â€¯043 â‚¬	3â€¯130 â‚¬	7â€¯304 â‚¬	10â€¯434 â‚¬
Peugeot	308 2010	13â€¯125 â‚¬	220	130	4	30	394 â‚¬	1â€¯181 â‚¬	2â€¯756 â‚¬	3â€¯938 â‚¬
Peugeot	308 2010 V	4â€¯625 â‚¬	220	130	4	30	139 â‚¬	416 â‚¬	971 â‚¬	1â€¯388 â‚¬
Peugeot	508 2021 PSE SW	30â€¯128 â‚¬	266	260	4	30	904 â‚¬	2â€¯712 â‚¬	6â€¯327 â‚¬	9â€¯038 â‚¬
Peugeot	308 GTI 2016	30â€¯356 â‚¬	250	270	4	30	911 â‚¬	2â€¯732 â‚¬	6â€¯375 â‚¬	9â€¯107 â‚¬
Peugeot	308 GTI 2016 Black Pack	35â€¯640 â‚¬	250	270	4	30	1â€¯069 â‚¬	3â€¯208 â‚¬	7â€¯484 â‚¬	10â€¯692 â‚¬
Peugeot	308 GT 2022	39â€¯500 â‚¬	250	225	4	30	1â€¯185 â‚¬	3â€¯555 â‚¬	8â€¯295 â‚¬	11â€¯850 â‚¬
Peugeot	308 SW 2023 Hybride	45â€¯000 â‚¬	250	225	4	30	1â€¯350 â‚¬	4â€¯050 â‚¬	9â€¯450 â‚¬	13â€¯500 â‚¬
Peugeot	3008 2021 Hybride	56â€¯525 â‚¬	266	300	4	50	1â€¯696 â‚¬	5â€¯087 â‚¬	11â€¯870 â‚¬	16â€¯958 â‚¬
Peugeot	508 GT 2019	31â€¯219 â‚¬	252	177	3	35	937 â‚¬	2â€¯810 â‚¬	6â€¯556 â‚¬	9â€¯366 â‚¬
Peugeot	508 SW 2013	36â€¯938 â‚¬	235	204	4	45	1â€¯108 â‚¬	3â€¯324 â‚¬	7â€¯757 â‚¬	11â€¯081 â‚¬
Peugeot	508 SW PSE 2023	63â€¯150 â‚¬	270	360	4	40	1â€¯895 â‚¬	5â€¯684 â‚¬	13â€¯262 â‚¬	18â€¯945 â‚¬
Peugeot	408 GT	42â€¯500 â‚¬	245	225	4	30	1â€¯275 â‚¬	3â€¯825 â‚¬	8â€¯925 â‚¬	12â€¯750 â‚¬
Peugeot	5008 2021	44â€¯813 â‚¬	245	250	4	100	1â€¯344 â‚¬	4â€¯033 â‚¬	9â€¯411 â‚¬	13â€¯444 â‚¬
Peugeot	5008 2024	48â€¯520 â‚¬	250	203	4	80	1â€¯456 â‚¬	4â€¯367 â‚¬	10â€¯189 â‚¬	14â€¯556 â‚¬
Peugeot	E-5008 2024	62â€¯990 â‚¬	237	210	4	80	1â€¯890 â‚¬	5â€¯669 â‚¬	13â€¯228 â‚¬	18â€¯897 â‚¬
Peugeot	E-Legend Concept	70â€¯313 â‚¬	220	350	3	25	2â€¯109 â‚¬	6â€¯328 â‚¬	14â€¯766 â‚¬	21â€¯094 â‚¬
Porsche	718 Boxster S 2017	63â€¯656 â‚¬	285	350	1	15	1â€¯910 â‚¬	5â€¯729 â‚¬	13â€¯368 â‚¬	19â€¯097 â‚¬
Porsche	911 Carrera S 2016	107â€¯719 â‚¬	300	530	1	15	3â€¯232 â‚¬	9â€¯695 â‚¬	22â€¯621 â‚¬	32â€¯316 â‚¬
Porsche	911 GT2 RS	271â€¯097 â‚¬	340	700	1	15	8â€¯133 â‚¬	24â€¯399 â‚¬	56â€¯930 â‚¬	81â€¯329 â‚¬
Porsche	911 GT3 2022	244â€¯700 â‚¬	296	730	1	15	7â€¯341 â‚¬	22â€¯023 â‚¬	51â€¯387 â‚¬	73â€¯410 â‚¬
Porsche	911 GT3 RS	320â€¯000 â‚¬	300	525	1	15	9â€¯600 â‚¬	28â€¯800 â‚¬	67â€¯200 â‚¬	96â€¯000 â‚¬
Porsche	918 Spyder 2016	831â€¯563 â‚¬	349	887	1	15	24â€¯947 â‚¬	74â€¯841 â‚¬	174â€¯628 â‚¬	249â€¯469 â‚¬
Porsche	911 (993) 1995	114â€¯375 â‚¬	300	450	3	15	3â€¯431 â‚¬	10â€¯294 â‚¬	24â€¯019 â‚¬	34â€¯313 â‚¬
Porsche	Cayenne Turbo 2013	46â€¯875 â‚¬	258	177	4	45	1â€¯406 â‚¬	4â€¯219 â‚¬	9â€¯844 â‚¬	14â€¯063 â‚¬
Porsche	911 GT2 2005	125â€¯000 â‚¬	340	530	3	15	3â€¯750 â‚¬	11â€¯250 â‚¬	26â€¯250 â‚¬	37â€¯500 â‚¬
Porsche	Cayenne Turbo Coupe 2020	149â€¯250 â‚¬	290	550	4	45	4â€¯478 â‚¬	13â€¯433 â‚¬	31â€¯343 â‚¬	44â€¯775 â‚¬
Porsche	Cayman 718 GT4RS	198â€¯000 â‚¬	317	600	1	45	5â€¯940 â‚¬	17â€¯820 â‚¬	41â€¯580 â‚¬	59â€¯400 â‚¬
Porsche	Macan 2019	79â€¯594 â‚¬	261	500	4	15	2â€¯388 â‚¬	7â€¯163 â‚¬	16â€¯715 â‚¬	23â€¯878 â‚¬
Porsche	Panamera Turbo e-hybrid	135â€¯000 â‚¬	315	680	3	15	4â€¯050 â‚¬	12â€¯150 â‚¬	28â€¯350 â‚¬	40â€¯500 â‚¬
Porsche	Taycan 2020	145â€¯830 â‚¬	260	630	3	15	4â€¯375 â‚¬	13â€¯125 â‚¬	30â€¯624 â‚¬	43â€¯749 â‚¬
Porsche	Taycan Turismo Cross	160â€¯000 â‚¬	230	510	4	25	4â€¯800 â‚¬	14â€¯400 â‚¬	33â€¯600 â‚¬	48â€¯000 â‚¬
Porsche	Taycan Turbo GT 2025	218â€¯745 â‚¬	315	1019	1	15	6â€¯562 â‚¬	19â€¯687 â‚¬	45â€¯936 â‚¬	65â€¯624 â‚¬
Porsche	911 Turbo S	250â€¯260 â‚¬	330	650	1	20	7â€¯508 â‚¬	22â€¯523 â‚¬	52â€¯555 â‚¬	75â€¯078 â‚¬
Poids Lourds	Mercedes Atego LÃ©ger	78â€¯750 â‚¬	140	325	1	600	2â€¯363 â‚¬	7â€¯088 â‚¬	16â€¯538 â‚¬	23â€¯625 â‚¬
Poids Lourds	Mercedes Atego	90â€¯000 â‚¬	151	325	1	700	2â€¯700 â‚¬	8â€¯100 â‚¬	18â€¯900 â‚¬	27â€¯000 â‚¬
Poids Lourds	Mercedes Atego Long	101â€¯250 â‚¬	151	325	1	800	3â€¯038 â‚¬	9â€¯113 â‚¬	21â€¯263 â‚¬	30â€¯375 â‚¬
Poids Lourds	Mercedes Atego Lourd	108â€¯750 â‚¬	151	325	1	850	3â€¯263 â‚¬	9â€¯788 â‚¬	22â€¯838 â‚¬	32â€¯625 â‚¬
Poids Lourds	Mercedes Unimog Transport	101â€¯250 â‚¬	175	325	2	600	3â€¯038 â‚¬	9â€¯113 â‚¬	21â€¯263 â‚¬	30â€¯375 â‚¬
Poids Lourds	Mitsubishi Fuso	78â€¯750 â‚¬	145	400	1	600	2â€¯363 â‚¬	7â€¯088 â‚¬	16â€¯538 â‚¬	23â€¯625 â‚¬
Poids Lourds	Renault Midlum	90â€¯000 â‚¬	140	325	2	700	2â€¯700 â‚¬	8â€¯100 â‚¬	18â€¯900 â‚¬	27â€¯000 â‚¬
Poids Lourds	Renault Midlum Court	78â€¯750 â‚¬	140	325	2	600	2â€¯363 â‚¬	7â€¯088 â‚¬	16â€¯538 â‚¬	23â€¯625 â‚¬
Poids Lourds	Renault Midlum Loud Transport Interieur	108â€¯750 â‚¬	140	325	2	550	3â€¯263 â‚¬	9â€¯788 â‚¬	22â€¯838 â‚¬	32â€¯625 â‚¬
Poids Lourds	Renault Midlum Long	101â€¯250 â‚¬	140	325	2	800	3â€¯038 â‚¬	9â€¯113 â‚¬	21â€¯263 â‚¬	30â€¯375 â‚¬
Poids Lourds	Renault Midlum Lourd	108â€¯750 â‚¬	140	325	2	850	3â€¯263 â‚¬	9â€¯788 â‚¬	22â€¯838 â‚¬	32â€¯625 â‚¬
Poids Lourds	Volvo FH16 460 Bache Civ	105â€¯250 â‚¬	142	250	2	820	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Bache Axeco	105â€¯250 â‚¬	142	250	2	820	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Bache EMH	105â€¯250 â‚¬	142	250	2	820	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Bache H2O	105â€¯250 â‚¬	142	250	2	820	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Bache Instant Gaming	105â€¯250 â‚¬	142	250	2	820	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Bache VCL	105â€¯250 â‚¬	142	250	2	820	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Bache Wisolar	105â€¯250 â‚¬	142	250	2	820	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Long Bache Civ	105â€¯250 â‚¬	142	460	2	875	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Long Bache Axeco	105â€¯250 â‚¬	142	460	2	875	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Long Bache EMH	105â€¯250 â‚¬	142	460	2	875	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Long Bache H2O	105â€¯250 â‚¬	142	460	2	875	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Long Bache Instang Gaming	105â€¯250 â‚¬	142	460	2	875	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Long Bache VCL	105â€¯250 â‚¬	142	460	2	875	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬
Poids Lourds	Volvo FH16 460 Long Bache Wisolar	105â€¯250 â‚¬	142	460	2	875	3â€¯158 â‚¬	9â€¯473 â‚¬	22â€¯103 â‚¬	31â€¯575 â‚¬`;
  
  const linesArray = data.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('//'));
  let imported = 0, errors = 0, skipped = 0;
  
  console.log(`ğŸš€ DÃ©but de l'importation de ${linesArray.length} vÃ©hicules dans la deuxiÃ¨me base...\n`);
  
  for (let i = 0; i < linesArray.length; i++) {
    const line = linesArray[i];
    const parts = line.split('\t');
    
    if (parts.length < 11) {
      console.warn(`âš ï¸  Ligne ${i + 1} ignorÃ©e (colonnes insuffisantes: ${parts.length})`);
      skipped++;
      continue;
    }
    
    const vehicle = {
      type: parts[0]?.trim() || 'Autre',
      modele: parts[1]?.trim() || '',
      prixAchat: parseFrenchNumber(parts[2]) || 0,
      vitesseMax: parseFrenchNumber(parts[3]),
      puissance: parseFrenchNumber(parts[4]),
      nombrePlaces: parseFrenchNumber(parts[5]),
      coffre: parseFrenchNumber(parts[6]),
      assuranceTier1: parseFrenchNumber(parts[7]),
      assuranceTier2: parseFrenchNumber(parts[8]),
      assuranceTier3: parseFrenchNumber(parts[9]),
      assuranceTier4: parseFrenchNumber(parts[10]),
      achete: false,
      createdAt: serverTimestamp()
    };
    
    if (!vehicle.modele || !vehicle.prixAchat) {
      console.warn(`âš ï¸  Ligne ${i + 1} ignorÃ©e (donnÃ©es incomplÃ¨tes)`);
      skipped++;
      continue;
    }
    
    try {
      await addDoc(collection(db2, 'flotte'), vehicle);
      imported++;
      if (imported % 10 === 0 || imported === 1) {
        console.log(`âœ… [${imported}] ${vehicle.type} ${vehicle.modele}`);
      }
      if (imported % 50 === 0) {
        await new Promise(resolve => setTimeout(resolve, 500));
      }
    } catch (error) {
      console.error(`âŒ Erreur ligne ${i + 1}: ${vehicle.modele}`, error.message || error);
      errors++;
    }
  }
  
  console.log('\n' + '='.repeat(50));
  console.log('ğŸ“Š RÃ‰SUMÃ‰ DE L\'IMPORT');
  console.log('='.repeat(50));
  console.log(`âœ… ImportÃ©s: ${imported}`);
  console.log(`âŒ Erreurs: ${errors}`);
  console.log(`âš ï¸  IgnorÃ©s: ${skipped}`);
  console.log(`ğŸ“¦ Total traitÃ©: ${linesArray.length}`);
  console.log(`ğŸ—„ï¸  Base: ${window.firebaseConfig2.projectId}`);
  console.log('='.repeat(50));
})();